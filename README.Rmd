---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "80%"
)
```

# optedr

<!-- badges: start -->
<!-- use_this::use_cran_badge() -->

<!-- use_this::use_lifecycle_badge(stage) -->
[![CRAN status](https://www.r-pkg.org/badges/version/optedr)](https://CRAN.R-project.org/package=optedr)
[![Lifecycle: stable](https://img.shields.io/badge/lifecycle-stable-brightgreen.svg)](https://lifecycle.r-lib.org/articles/stages.html#stable)
<!-- badges: end -->

## Overview

The package **optedr** is an optimal experimental design suite for calculating optimal designs, D-augmenting designs and efficiently rounding approximate design. Among its capabilities are:

- Calculating D-, Ds-, A- and I-optimal designs for non-linear models.
- D-augment designs controlling the loss of efficiency.
- Evaluate the efficiency of a given design against the optimum.
- Efficiently rounding approximate designs to exact designs.


## Installation

You can install the released version of optedr from [CRAN](https://CRAN.R-project.org) with:

```{r ex, eval=FALSE}
install.packages("optedr")
```

You can install the latest version of the package from [GitHub](https://github.com/) with:

```{r example, eval=FALSE}
devtools::install_github("kezrael/optedr")
```

## Functions

The user available functions are:

- `opt_des()` calculates optimal designs.
- `design_efficiency()` evaluates the efficiency of a design against the optimum.
- `augment_design()` augments designs, allowing the user to add points controlling the D-efficiency.
- `efficient_round()` efficiently round approximate designs.
- `shiny_optimal()` demo of optimal designs calculation with a graphical interface, applied to *Antoine's Equation*.
- `shiny_augment()` demo of augmenting design with a graphical interface, usable for a handful of models.

The `optdes` object generated by `opt_des()` has its own implementation of `print()`, `summary()` and `plot()`.

## Usage

```{r, eval=FALSE}
library(optedr)
```

```{r, echo = FALSE}
devtools::load_all()
```

The calculation of an optimal design requires a to specify the `criterion`, the `model`, the `parameters` and their initial values and the `design_space`.

```{r}
resArr.D <- opt_des(criterion = "D-Optimality",
                    model = y ~ a*exp(-b/x),
                    parameters = c("a", "b"),
                    par_values = c(1, 1500),
                    design_space = c(212, 422))

resArr.D$optdes
resArr.D$sens
resArr.D$convergence
```

After calculating the D-optimal design, the user might want to add points to the design to fit their needs: 

```{r, echo = FALSE}
mockery::stub(augment_design, "readline", mockery::mock(0.8, 260, 0.15, 380, 0.15, "f"))
```


```{r}
aug_arr <- augment_design("D-Optimality", resArr.D$optdes, 0.3, y ~ a * exp(-b/x),
               parameters = c("a", "b"),
               par_values = c(1, 1500),
               design_space = c(212, 422),
               F)
aug_arr
```


This new design can be rounded to the desired number of points:



```{r, eval = FALSE}
(exact_design <- efficient_round(aug_arr, 20))
```

```{r, echo=FALSE}
(exact_design <- data.frame("Point" = c(329.2966, 422.0000, 260.0000, 380.0000), "Weight" = c(7, 7, 3, 3)))
```

And its efficiency compared against the optimum:

```{r}
aprox_design <- exact_design
aprox_design$Weight <- aprox_design$Weight / sum(aprox_design$Weight)

design_efficiency(aprox_design, resArr.D)
```




